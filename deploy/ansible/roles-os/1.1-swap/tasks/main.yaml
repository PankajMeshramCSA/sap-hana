# /*----------------------------------------------------------------------------8
# |                                                                            |
# |            Role for ensuring the swap space is configured correctly         |
# |                                                                            |
# +------------------------------------4--------------------------------------*/
---
# -------------------------------------+---------------------------------------8
#
# Task: 1.1     - swap space setup
#
# -------------------------------------+---------------------------------------8

# TODO: 20210127 Review
#       1) This could be written to be more efficient
#       2) waagent config should not run on Baremetal
#          -Update: I have assumed that the tier for Baremetal is going to be named "HLI"

- name:                           Ensure variables are available
  include_vars:
    file:                         "../../../vars/sap-disks.yaml"

# -------------------------------------+---------------------------------------
# The tier from sap-disks should match the node_tier from SID_hosts.yaml
# -------------------------------------+---------------------------------------
- name:                           Check if loop is being effected by tier at playbook level
  ansible.builtin.debug:
    msg:                          "Selected node_tier for hostname {{ansible_hostname }} -> {{ sapswap.tier }}"
    verbosity:                    2
  loop:                           "{{ sap_swap }}"
  loop_control:
    loop_var:                     sapswap
  when:
                                  - ansible_os_family != "Windows"
                                  - sapswap.tier != "HLI"
                                  - sapswap.tier in ["all", node_tier] 


# -------------------------------------+---------------------------------------
# call the swap space configuration tasks
# -------------------------------------+---------------------------------------
- include_tasks:                  configure.yaml
  loop:                           "{{ sap_swap }}"
  loop_control:
    loop_var:                     sapswap
  when:
                                  - ansible_os_family != "Windows"
                                  - sapswap.tier != "HLI"
                                  - sapswap.tier in ["all", node_tier]

...
